--local Network = require "Network"
--local Event = require 'Event'
local protobuf = require "protobuf"
--local Network = require "Network"

---------------------------------------------------------------------------
--成员变量
---------------------------------------------------------------------------
Player = {}
local this = Player

local _player = nil --玩家数据
---------------------------------------------------------------------------
--获取玩家ID
---------------------------------------------------------------------------
function Player.GetID()
	return _player.common_prop.entity_id
end

---------------------------------------------------------------------------
--加载场景
---------------------------------------------------------------------------
function Player.LoadScene(type_t, buffer)
    local enter_game = protobuf.decode("Adoter.Asset.EnterGame", buffer)
    print(type(buffer))
    print(enter_game.type_t)
    print(enter_game.player_id)
	--resMgr:LoadPrefab("Scene", { 'PromptItem' }, this.OnLoadSuccess);
end

---------------------------------------------------------------------------
--数据封装
---------------------------------------------------------------------------

function Player.CmdCreatePlayer()
    -- body
    local CreatePlayer = {}
    this.SendProtocol("CreatePlayer",CreatePlayer)
end

function Player.CmdLogin(name,passWord)
    -- body
    local Login = {
        account = {
            username = name,--""
            password = passWord,--""
        }
    }
    this.SendProtocol("Login",Login)
end

function Player.CmdEnterGame(id)
    -- body
    local EnterGame = {
        player_id = id,
    }
    this.SendProtocol("EnterGame",EnterGame)
end

function Player.CmdCreteRoom(id,name,passWord)
    -- body
    local CreatRoom ={
        room = {
            room_id = id,--1,
            room_name = name,--"123",
            enter_password  = passWord,--"123",
        }
    }
    this.SendProtocol("CreatRoom",CreatRoom)
end

function Player.CmdEnterRoom(id,passWord)
    -- body
    local EnterRoom = {
        room_id = id,--2;
        enter_password = passWord,--"123";
    }
    this.SendProtocol("EnterRoom",EnterRoom)
end


function Player.OnLoadSuccess()
	this.CmdEnterScene()
end
---------------------------------------------------------------------------
--发送协议
---------------------------------------------------------------------------
---[[
function Player.SendProtocol(messageName,message)
	Network.SendProtocol(messageName,message)
end
---------------------------------------------------------------------------
--进入游戏
---------------------------------------------------------------------------
--[[
function Player.CmdEnterGame(player_id)
    local enter_game = P_Protocol.EnterGame()
    enter_game.player_id = player_id
    -------------------------------------------
    this.SendProtocol(enter_game)
end
--]]
---------------------------------------------------------------------------
--进入场景
---------------------------------------------------------------------------
function Player.CmdEnterScene(scene_id)
    local enter_scene = P_Protocol.EnterScene()
    enter_scene.scene_id = scene_id
    ---------------------------------------------
    this.SendProtocol(enter_scene)
end
--]]

--[[
	协议处理：
	
	1.在Network中注册接收协议对应的响应函数；
	
	2.在本文件中实现响应函数；
--]]

---------------------------------------------------------------------------
--同步玩家数据
---------------------------------------------------------------------------
function Player.OnPlayerInfo(stuff)
	log("收到玩家数据...")
    local player_info = P_Protocol.PlayerInfo()
    player_info:ParseFromString(stuff)
    print(stuff)
    --更新玩家数据
    print(player_info)
    _player = player_info.player
    print(_player)
 	--设置玩家ID
    print(_player.common_prop.entity_id)
    print('Load data success, player_id:>'.._player.common_prop.entity_id)
end
---------------------------------------------------------------------------
--周围物体、玩家移动
---------------------------------------------------------------------------
function Player.OnSurroundChanged(stuff)
    logWarn('OnSurroundChanged...');
    local surrouds = P_Protocol.SurroundingsChanged()
    surrouds:ParseFromString(stuff)
    
    local entity_id = surrouds.entity_id
    logWarn(entity_id)
end
---------------------------------------------------------------------------
return Player