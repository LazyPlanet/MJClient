ClickEvent = {}
ClickEvent.panelTable = {}
ClickEvent.panelTable._main_ui = "Login"
ClickEvent.panelTable._choose_ui = "MainMenu"
ClickEvent.panelTable._create_room_ui = "CreateRoom"
ClickEvent.panelTable._join_room_ui = "GetintoRoom"
ClickEvent.panelTable._other_message_ui = "OtherMessageUI"
ClickEvent.panelTable._player_message_ui = "PlayerMessageUI"
ClickEvent.panelTable._store_ui = "StoreUI"
ClickEvent.panelTable._play_game_ui = "PlaySence"
ClickEvent.panelTable._player_info = "PlayerInfo"
ClickEvent.panelTable._other_player_info = "OtherPlayerInfo"
ClickEvent.panelTable._calculate_ui = "ClearRoundScene"
ClickEvent.uiPanel = nil
ClickEvent.isInDouRoom = false

ClickEvent._createObject = {}
ClickEvent._play_ui = {}

local _position_index = {
	POSITION_TYPE_EAST = 1,
	POSITION_TYPE_SOUTH = 2,
	POSITION_TYPE_WEST = 3,
	POSITION_TYPE_NORTH = 4,
}

local operationState = Enum.CreateEnumTable({"WAIT", "PENG", "GANG", "CHI", "HU", "DAPAI"},-1)

local _currentPanel = {}
local _popPanel = {}

function ClickEvent.Awake( ... )
	-- body
	UIPackage.AddPackage("FairyUI/MXUI")
	ClickEvent.uiPanel = CS.UnityEngine.GameObject.Find("UIPanel"):GetComponent("UIPanel")
end
function ClickEvent.Start(loadUI)
	-- body
	CS.UnityEngine.Application.targetFrameRate = 60
	--ClickEvent.uiPanel.ui:RemoveChildren()
	ClickEvent.CreateNewPanel(loadUI)
end

function ClickEvent.DeletePanel(deletePanel)
	-- body
	GRoot.inst:RemoveChild(deletePanel)
end

function ClickEvent.CreateNewPanel(panelName)
	-- body
	if not panelName and Player._invoke_data then
		panelName = Player._invoke_data
	end
	--[[
	local tempObj = CS.UnityEngine.Resources.Load("UIPrefab/"..panelName)
	_currentPanel.panel = CS.UnityEngine.Object.Instantiate(tempObj,ClickEvent.self.transform)
	_currentPanel.panel.transform.localScale = CS.UnityEngine.Vector3.one
	_currentPanel.eventTriggerListener = _currentPanel.panel:GetComponent("EventTriggerListener")
	_currentPanel.eventTriggerListener.onClick = ClickEvent.registerButtonClick
	_currentPanel.buttonList = _currentPanel.eventTriggerListener._buttons
	_currentPanel.toggleList = _currentPanel.eventTriggerListener._toggles
	--]]
	if not ClickEvent._createObject[panelName] then
		ClickEvent._createObject[panelName] = UIPackage.CreateObject("MXUI", panelName).asCom
	end
	_currentPanel.panel = ClickEvent._createObject[panelName]
	_currentPanel.panel:SetSize(GRoot.inst.width, GRoot.inst.height)
	GRoot.inst:AddChild(_currentPanel.panel)
	local childNumber = _currentPanel.panel.numChildren
	for i=0,childNumber-1 do
		local obj = _currentPanel.panel:GetChildAt(i)
		if obj.group and obj.group.name == "Btns" then
			obj.onClick:Add(ClickEvent.registerButtonClick)
		end
	end
	if Player._id and _currentPanel.panel:GetChild("Name") and _currentPanel.panel:GetChild("Name"):GetChild("PlayerName") then
		_currentPanel.panel:GetChild("Name"):GetChild("PlayerName").text = tostring(Player._id)
	end
	if not ClickEvent._play_ui then
		ClickEvent._play_ui = {}
	end
	ClickEvent._play_ui.operationBar = _currentPanel.panel:GetChild("GameOperationBar")
	ClickEvent._play_ui.passButton = _currentPanel.panel:GetChild("GamePassButton")
	if ClickEvent._play_ui.passButton then
		ClickEvent._play_ui.passButton.visible = false
	end
	ClickEvent._play_ui.hintBar = _currentPanel.panel:GetChild("GameHintBar")
	if ClickEvent._play_ui.hintBar then
		ClickEvent._play_ui.hintBar.visible = false
	end
	ClickEvent._play_ui.roomId = _currentPanel.panel:GetChild("RoomID")
	if ClickEvent._play_ui.roomId then
		ClickEvent._play_ui.roomId.text = tostring(Player._roomId)
	end
	--[[
	if panelName == ClickEvent.panelTable._play_game_ui then

		_currentPanel.roomIdText = _currentPanel.panel.transform:Find("RoomId").gameObject:GetComponent("Text")
		_currentPanel.roomIdText.text = tostring(Player._roomId)

		_currentPanel.starGameButton = 0
		_currentPanel.operationButton = {}
		_currentPanel.operationButton.gangButton = 1
		_currentPanel.operationButton.chiButton = 2
		_currentPanel.operationButton.pengButton = 3
		_currentPanel.operationButton.huButton = 4
		_currentPanel.operationButton.guoButton = 5
		for k,v in pairs(_currentPanel.operationButton) do
			_currentPanel.buttonList[v].gameObject:SetActive(false)
		end
	elseif panelName == ClickEvent.panelTable._choose_ui then
		_currentPanel.playerIdText = _currentPanel.panel.transform:Find("Player/PlayerIdShow"):GetComponent("Text")
		if Player._id then
			_currentPanel.playerIdText.text = tostring(Player._id)
		end
	end
	--]]
end

function ClickEvent.CreateOperationButton( ... )
	-- body
	_currentPanel.buttonList = {}
	_currentPanel.buttonList["GameChiButton"] = UIPackage.GetItemURL("MXUI","GameChiButton")
	_currentPanel.buttonList["GamePengButton"] = UIPackage.GetItemURL("MXUI","GamePengButton")
	_currentPanel.buttonList["GameGangButton"] = UIPackage.GetItemURL("MXUI","GameGangButton")
	_currentPanel.buttonList["GameHuButton"] = UIPackage.GetItemURL("MXUI","GameHuButton")
end

function ClickEvent.AddOperationButton( buttonName )
	-- body
	local operationButtonTemp = ClickEvent._play_ui.operationBar:AddItemFromPool(_currentPanel.buttonList[buttonName])
	operationButtonTemp.name = buttonName
	operationButtonTemp.onClick:Add(ClickEvent.registerButtonClick)
end

function ClickEvent.RoomInformationUpdate( ... )
	-- body
	local x = _position_index[Player._my_player_data.position]
	for k,v in pairs(_position_index) do
		if v >= x then
			_position_index[k] = v - x + 1
		else
			_position_index[k] = 5 + v - x
		end
	end
	for k,v in pairs(_position_index) do
		print(k,v)
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 1 then
			_currentPanel.panel:GetChild("BehindPlayerAvatarInfo"):GetChild("DouNum").text = v.common_prop.name
		elseif tempX == 2 then
			_currentPanel.panel:GetChild("OppositePlayerAvatarInfo"):GetChild("DouNum").text = v.common_prop.name
		elseif tempX == 3 then
			_currentPanel.panel:GetChild("FrontPlayerAvatarInfo"):GetChild("DouNum").text = v.common_prop.name
		else
			_currentPanel.panel:GetChild("PlayerAvatarInfo"):GetChild("DouNum").text = v.common_prop.name
		end
	end
end

function ClickEvent.PaiOperationState()
	-- body
	local tempStateTable = Player.MahJong.GetStateTable()
    for k,v in pairs(tempStateTable) do
    	print(v)
    	ClickEvent._play_ui.passButton.visible = true
		if v == "PAI_CHECK_RETURN_HU" then
			ClickEvent.AddOperationButton("GameHuButton")
	        Player.MahJong.SetCurrentState(operationState.HU)
		elseif v == "PAI_CHECK_RETURN_GANG" then
			ClickEvent.AddOperationButton("GameGangButton")
	        Player.MahJong.SetCurrentState(operationState.GANG)
		elseif v == "PAI_CHECK_RETURN_PENG" then
			ClickEvent.AddOperationButton("GamePengButton")
	        Player.MahJong.SetCurrentState(operationState.PENG)
		elseif v == "PAI_CHECK_RETURN_CHI" then
			Player.MahJong.SetCurrentState(operationState.CHI)
			Player.MahJong.CheckChiPai()
		else
	    	ClickEvent._play_ui.passButton.visible = false
			print("PAI_CHECK_RETURN_NULL ")
			print(ClickEvent.MahJong.GetCurrentState())
		end
    end
    Player.MahJong.SetStateTable({})
end

function ClickEvent.ShowChiButton()
	-- body
	ClickEvent.AddOperationButton("GameChiButton")
end

function ClickEvent.PopPanel( panelName )
	-- body
	if not ClickEvent._createObject[panelName] then
		ClickEvent._createObject[panelName] = UIPackage.CreateObject("MXUI", panelName).asCom
	end
	ClickEvent.Close()
	_popPanel.panel = ClickEvent._createObject[panelName]
	_popPanel.panel:SetSize(GRoot.inst.width, GRoot.inst.height)
	_popPanel.panel:Center()
	GRoot.inst:AddChild(_popPanel.panel)
	local childNumber = _popPanel.panel.numChildren
	for i=0,childNumber-1 do
		local obj = _popPanel.panel:GetChildAt(i)
		if obj.group and obj.group.name == "Btns" then
			obj.onClick:Add(ClickEvent.registerButtonClick)
		end
	end
	--[[
	local tempObj = CS.UnityEngine.Resources.Load("UIPrefab/"..panelName)
	_popPanel.panel = CS.UnityEngine.Object.Instantiate(tempObj,ClickEvent.self.transform)
	_popPanel.panel.transform.localScale = CS.UnityEngine.Vector3.one
	_popPanel.eventTriggerListener = _popPanel.panel:GetComponent("EventTriggerListener")
	_popPanel.eventTriggerListener.onClick = ClickEvent.registerButtonClick
	_popPanel.buttonList = _popPanel.eventTriggerListener._buttons
	_popPanel.toggleList = _popPanel.eventTriggerListener._toggles
	--]]
end

function ClickEvent.DestroyPanel(gameObject)
	-- body
	CS.UnityEngine.Object.Destroy(gameObject)
	if _popPanel then
		_popPanel = {}
	else
		_currentPanel = {}
	end
end

function ClickEvent.showCalculate( ... )
	-- body
	if not Player._calculate_data or not Player._all_players_data or not Player._my_player_data.position then
		return
	end
	local myPosition = Player._my_player_data.position
	ClickEvent.PopPanel(ClickEvent.panelTable._calculate_ui)
	for k,v in pairs(Player._calculate_data.record.list) do
		local currentPosition
		for j,m in pairs(Player._all_players_data) do
			if v.player_id == m.common_prop.player_id then
				currentPosition = m.position
				break
			end
		end
		local tempX = _position_index[currentPosition] - _position_index[myPosition]
		if tempX == 1 then
			_popPanel.panel:GetChild("BehindPlayerClearInfo"):GetChild("PlayerName").text = v.player_id
			_popPanel.panel:GetChild("BehindPlayerClearInfo"):GetChild("DouNum").text = v.score
		elseif tempX == 2 then
			_popPanel.panel:GetChild("OppositePlayerClearInfo"):GetChild("PlayerName").text = v.player_id
			_popPanel.panel:GetChild("OppositePlayerClearInfo"):GetChild("DouNum").text = v.score
		elseif tempX == 3 then
			_popPanel.panel:GetChild("FrontPlayerClearInfo"):GetChild("PlayerName").text = v.player_id
			_popPanel.panel:GetChild("FrontPlayerClearInfo"):GetChild("DouNum").text = v.score
		else
			_popPanel.panel:GetChild("MyClearInfo"):GetChild("PlayerName").text = v.player_id
			_popPanel.panel:GetChild("MyClearInfo"):GetChild("DouNum").text = v.score
		end
	end
end
---------------------------------------------------------------------------
-------------点击功能函数
---------------------------------------------------------------------------

function ClickEvent.PlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._player_info)
	_popPanel.panel:RemoveChild(_popPanel.panel:GetChild("BoundAccount"))
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 0 then
			_popPanel.panel:GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			_popPanel.panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel.panel:GetChild("GemsNum").text = tostring(v.common_prop.diamond)
			_popPanel.panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel.panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			--[[
			_popPanel.panel:GetChild("").text = 
			_popPanel.panel:GetChild("").text = 
			_popPanel.panel:GetChild("") = 
			--]]
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.BehindPlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._other_player_info)
	if Player._my_player_data.position ~= "POSITION_TYPE_EAST" then
		_popPanel.panel:RemoveChild(_popPanel.panel:GetChild("KickOutRoomButton"))
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 1 then
			_popPanel.panel:GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			_popPanel.panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel.panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel.panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.OppositePlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._other_player_info)
	if Player._my_player_data.position ~= "POSITION_TYPE_EAST" then
		_popPanel.panel:RemoveChild(_popPanel.panel:GetChild("KickOutRoomButton"))
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 2 then
			_popPanel.panel:GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			_popPanel.panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel.panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel.panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.FrontPlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._other_player_info)
	if Player._my_player_data.position ~= "POSITION_TYPE_EAST" then
		_popPanel.panel:RemoveChild(_popPanel.panel:GetChild("KickOutRoomButton"))
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 3 then
			_popPanel.panel:GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			_popPanel.panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel.panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel.panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.PlayerID( gameObject )
	-- body
	Player._string_id = gameObject:GetComponent("InputField").text
end

function ClickEvent.PlayerPassword( gameObject )
	-- body
	Player._password = gameObject:GetComponent("InputField").text
end

function ClickEvent.LoginButton(gameObject)
	-- body
	local textShow = _currentPanel.panel:GetChild("Account"):GetChild("InputText")
	Player._string_id = textShow.text
	Player.CmdLogin(Player._string_id)
end
function ClickEvent.Account( gameObject )
	-- body
	print(gameObject.name)
end

function ClickEvent.GuestLogin( gameObject )
	-- body
	--[[
	if _currentPanel.toggleList and _currentPanel.toggleList[0].isOn then
		ClickEvent.DestroyPanel(_currentPanel.panel)
		ClickEvent.CreateNewPanel(ClickEvent.panelTable._choose_ui)
	else
		print("no find toggle")
	end
	--]]
	ClickEvent.DeletePanel(_currentPanel.panel)
	ClickEvent.CreateNewPanel(ClickEvent.panelTable._choose_ui)
	Player.CmdEnterGame(Player._id)
	print("ClickEvent.GuestLogin")
end

function ClickEvent.Admit( gameObject )
	-- body
end

function ClickEvent.Back( ... )
	-- body
	if not ClickEvent.isInDouRoom then
		_currentPanel.panel:GetTransition("ShowFriendMode"):Stop(true,false)
		ClickEvent.DeletePanel(_currentPanel.panel)
		ClickEvent.CreateNewPanel(ClickEvent.panelTable._main_ui)
	else
		ClickEvent.isInDouRoom = false
		_currentPanel.panel:GetTransition("ShowFriendMode"):Play()
	end
end

function ClickEvent.PlayerLogo( ... )
	-- body
	print("playLogoShow")
	ClickEvent.PopPanel(ClickEvent.panelTable._player_message_ui)
	--_Player_Message_UI:SetActive(true)
end

function ClickEvent.DiamondPlus( ... )
	-- body
	print("DiamondPlusShow")
end

function ClickEvent.BeanPlus( ... )
	-- body
	print("BeanPlusShow")
end

function ClickEvent.TicketPlus( ... )
	-- body
	print("TicketPlusShow")
end

function ClickEvent.DouRoomButton( ... )
	-- body
	if _currentPanel.panel:GetTransition("HideFriendMode").playing then
		return
	end
	_currentPanel.panel:GetTransition("HideFriendMode"):Play()
	ClickEvent.isInDouRoom = true
end

function ClickEvent.GetintoRoomButton( ... )
	-- body
	print("JoinRoom")
	ClickEvent.PopPanel(ClickEvent.panelTable._join_room_ui)
end

function ClickEvent.CreateRoomButton( ... )
	-- body
	print("CreateRoom")
	ClickEvent.PopPanel(ClickEvent.panelTable._create_room_ui)
	--CS.UnityEngine.Application.LoadLevel("PlaySence")
end

function ClickEvent.Store( ... )
	-- body
end

function ClickEvent.Option( ... )
	-- body
end

function ClickEvent.Mail( ... )
	-- body
end

function ClickEvent.Rank( ... )
	-- body
end

function ClickEvent.Activity( ... )
	-- body
end

function ClickEvent.Method( ... )
	-- body
end

function ClickEvent.Reward( ... )
	-- body
end

function ClickEvent.More( ... )
	-- body
end

function ClickEvent.Close( ... )
	-- body
	print("ClosePanel")
	GRoot.inst:RemoveChild(_popPanel.panel)
end

function ClickEvent.CreateRoomId( gameObject )
	-- body
	Player._roomId = tonumber(gameObject:GetComponent("InputField").text)
	print(gameObject.name)
end

function ClickEvent.CreateButton( )
	-- body
	--roomid
	print("CreateRoom")
	local model = nil
	local extend_type = {}
	local top_mutiple = nil
	local open_rands = nil

	if _popPanel.panel:GetChild("ClassicMode").selected then
		model = "ROOM_MODEL_TYPE_CLASSICAL"
	elseif _popPanel.panel:GetChild("HighRiskMode").selected then
		model = "ROOM_MODEL_TYPE_MULTIPLE"
	end

	if _popPanel.panel:GetChild("Multiple8").selected then
		top_mutiple = 8
	elseif _popPanel.panel:GetChild("Multiple32").selected then
		top_mutiple = 32
	elseif _popPanel.panel:GetChild("MultipleNolimit").selected then
		top_mutiple = 0
	end

	if _popPanel.panel:GetChild("Round4").selected then
		open_rands = 4
	elseif _popPanel.panel:GetChild("Round8").selected then
		open_rands = 8
	end

	local extend_type_count = 1
	if _popPanel.panel:GetChild("ChooseFan01").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_ZHANLIHU"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel.panel:GetChild("ChooseFan02").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_JIAHU"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel.panel:GetChild("ChooseFan03").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_XUANFENGGANG"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel.panel:GetChild("ChooseFan04").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_BAOPAI"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel.panel:GetChild("ChooseFan05").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_DUANMEN"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel.panel:GetChild("ChooseFan06").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_HUIPAI"
		extend_type_count = extend_type_count + 1
	end
	Player.CmdCreateRoom(model,extend_type,top_mutiple,open_rands)
	ClickEvent.Close()
end

function ClickEvent.JoinRoomId( gameObject )
	-- body
	Player._roomId = tonumber(gameObject:GetComponent("InputField").text)
end

function ClickEvent.GetinButton( ... )
	-- body
	Player._roomId = tonumber(_popPanel.panel:GetChild("InputText").text)
	print(tonumber(Player._roomId))
	Player.CmdEnterRoom(Player._roomId)
	ClickEvent.Close()
end

-------------------------------------
---游戏中
---------------------------
function ClickEvent.GamePlayButton( gameObject )
	-- body
	Player.CmdGameOperation()
	gameObject.visible = false
end

function ClickEvent.GameGangButton(gameObject)
	-- body

	ClickEvent.CloseOperationPanel()
	Player.MahJong.GangPai()
end

function ClickEvent.GameChiButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	Player.MahJong.ChiPai()
end

function ClickEvent.GamePengButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	Player.MahJong.PengPai()
end

function ClickEvent.GameHuButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
    Player.MahJong.HuPai()
end

function ClickEvent.GamePassButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	Player.MahJong.GuoPai()
end

function ClickEvent.CloseOperationPanel()
	-- body
	ClickEvent._play_ui.operationBar:RemoveChildrenToPool()
	ClickEvent._play_ui.passButton.visible = false
end

---------------------------------------------------------------------------
---------------------------------------------------------------------------
function ClickEvent.registerButtonClick(gameObject)
	-- body
	local key = gameObject.sender.name
	--[[
	switch = {
		
		["Reward"] = function ( ... )
			-- body
		end,
		["More"] = function ( ... )
			-- body
		end,
		["ClosePlayerMessagePanel"] = function ( ... )
			-- body
			_Player_Message_UI:SetActive(false)
		end,
	}
	--]]
	local fSwitch = ClickEvent[key]

	if fSwitch then
		local result = fSwitch(gameObject.sender)
	else
		print(key)
		print("key no found")
	end

end

return ClickEvent